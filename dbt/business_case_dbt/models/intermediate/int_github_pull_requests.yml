version: 2

models:
  - name: int_github_pull_requests
    description: >-
      Intermediate model for GitHub Pull Requests. Grain: 1 row per PR
      (repo_owner, repo_name, pr_id).
    columns:
      - name: pk_pull_requests
        description: a unique key generated from repo_owner, epo_name and pr_id
        tests:
          - not_null
          - unique

      - name: repo_owner
        description: Repository owner / organization.
        tests:
          - not_null

      - name: repo_name
        description: Repository name.
        tests:
          - not_null

      - name: pr_id
        description: GitHub Pull Request internal ID (unique within GitHub).
        tests:
          - not_null

      - name: pr_number
        description: Pull Request number shown in the repo.
        tests:
          - not_null

      - name: pr_state
        description: Pull Request state (e.g. open, closed).
        tests:
          - not_null
          - accepted_values:
              values: ["open", "closed"]

      - name: is_draft
        description: Whether the PR is a draft.
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

      - name: title
        description: Pull Request title.
        tests:
          - not_null

      - name: author_login
        description: GitHub login of the PR author.
        tests:
          - not_null

      - name: author_type
        description: GitHub author type (e.g. User, Bot, Organization).
        tests:
          - not_null

      - name: created_at
        description: Timestamp when the PR was created.
        tests:
          - not_null

      - name: updated_at
        description: Timestamp when the PR was last updated.

      - name: closed_at
        description: Timestamp when the PR was closed (null if not closed).

      - name: merged_at
        description: Timestamp when the PR was merged (null if not merged).

      - name: requested_reviewers_count
        description: Count of requested reviewers on the PR.
        tests:
          - not_null

      - name: requested_reviewers
        description: >-
          Count of requested reviewers (duplicate of requested_reviewers_count if both exist).
        tests:
          - not_null

      - name: number_of_labels
        description: Count of labels on the PR.
        tests:
          - not_null

      - name: pull_request_body
        description: PR body text (markdown). Can be empty.

      - name: body_length
        description: Length of the PR body text (characters).
        tests:
          - not_null

      - name: emojis_used
        description: Count of emojis detected/used in the PR body.
        tests:
          - not_null

      - name: buzzwords_count
        description: >-
          Count the number of buzzwords used.
          Current words are: perf|performance|optimi|fix|refactor|security|breaking|blockchain|crypto

      - name: checked_boxes_count
        description: Looks for checked boxed in the PR body

      - name: source_updated_at
        description: Source-system updated timestamp for the record.
        tests:
          - not_null

      - name: _extracted_at
        description: Timestamp when the record was extracted/ingested.
        tests:
          - not_null

      - name: cycle_time_hours
        description: Hours from PR created_at to merged_at (null if not merged or draft)

      - name: pr_merged_within_day_flag
        description: A flag that indicates whether a pull request was merged within a day