version: 2

models:
  - name: fact_github_pull_requests
    description: >-
      Fact table for GitHub pull requests. Grain: 1 row per PR (repo_owner, repo_name, pr_id).
    columns:
      - name: pk_pull_requests
        description: A unique key generated from repo_owner, repo_name, and pr_id
        tests:
          - not_null
          - unique
          
      - name: fk_contributor
        description: Surrogate key for (repo_owner, repo_name, contributor_login)
        tests:
          - not_null
          - relationships:
              to: ref('dim_github_contributors')
              field: pk_contributor

      - name: repo_owner
        description: Repository owner
        tests:
          - not_null

      - name: repo_name
        description: Repository name
        tests:
          - not_null

      - name: pr_id
        description: GitHub PR id (stable primary key)
        tests:
          - not_null
          - unique

      - name: pr_number
        description: PR number shown in GitHub UI (not globally unique)

      - name: author_login
        description: GitHub login of the PR author

      - name: pr_state
        description: PR state from GitHub (open or closed)

      - name: is_draft
        description: Whether the PR is marked as draft

      - name: created_at
        description: Timestamp when the PR was created

      - name: merged_at
        description: Timestamp when the PR was merged

      - name: closed_at
        description: Timestamp when the PR was closed

      - name: cycle_time_hours
        description: Hours from PR created_at to merged_at (null if not merged or draft)
